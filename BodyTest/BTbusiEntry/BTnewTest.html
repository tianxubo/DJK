<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <script src="../../src/js/jquery.min.js"></script>
    <link rel="stylesheet" href="../../src/css/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="../../src/css/jquery.mobile.theme-f.css">
    <script>
		$(function(){
		
			$(":jqmData(role='page')").attr("data-title", document.title);
		
		});
	</script>
    <script src="../../src/js/jquery.mobile-1.4.5.min.js"></script>
	<title>都健康</title>
    <link rel="stylesheet" type="text/css" href="../../src/css/djk-main.css">
    <style type="text/css">
    	.perso_table{
    		text-align: center;
    	}
    	td,th{
    		width: 33%;
    		text-align: center;
    		padding:.4em 0;
    		font-size:1em;
    		border:none;
    	}
    	table{
    		width:100%;
    		border:3px solid #ffffff;
    	}
    	table tbody tr:nth-child(odd) {
		background-color: #f4f4f4;
		}
		table tbody tr:nth-child(even) {
		  background-color: #ffffff;
		}
		.add_person{
			border-top:1px solid #f8f8f8;
			margin-top:2em;
			background:#ffffff;
			padding-bottom: 2em
		}
		.add_person form label{
			margin: 1.1em 0em 1.1em 2em;
    		width: 5em;
			font-size: 1em;
		}
		.add_person form .input{
			font-size: 1em;
		}
		.ui-input-text{
			display: inline-block;
		}
		.djk_test_body .table_head{
			text-align: center;
			background:#fff
		}
		.djk_test_body .table_head span{
			font-size: 1em;
			margin: 0;
			display: inline-block;
		}
		#tBody_tao .hclick{
			background:#19AFC7;
			color:#ffffff;
		}
		#dialogBG{
			background:#000;
			opacity: 0.5;
			position: fixed;
			top:0;
			left:0;
			width:100%;
			height:100%;  
			display:none;
			z-index: 999
		}
		#dialog{
			position: fixed;
			left:50%;
			top:50%;
			text-align:center;
			display:none;
			overflow:auto;
			z-index: 1000;
			background:#fff;
			border-radius:5px;
			border:5px solid #19AFC7
		}
		.inner_border{
			margin:.5em .5em 1.9em .5em;
		}
		.money_num{
			font-size:1rem;
			margin:0;
		}
    </style>
  </head>
  <body>
  	<div data-role="page" class="djk_page" id="djk_testPer_info">
	  <div data-role="header" data-theme="f">
	  	<a class="back_a" data-rel="back" data-transition="slide" data-direction="reverse"><img src="../../src/images/Home/back.png"></a>
	    <h2 style="font-size:1.5em;font-weight: normal;text-shadow: none">体检人信息</h2>
	  </div>
	  <div data-role="main" class="ui-content">
	  	<div class="person_table">
	  		<table cellspacing="0">
	  			<thead>
	  				<tr>
	  				<th>姓名</th>
	  				<th>体检日期</th>
	  				<th>体检时间</th>
	  				</tr>
	  			</thead>
	  			<tbody id="first_tbody">
	  				<tr class="first_tr">
	  				<td></td>
	  				<td>下方添加体检人信息</td>
	  				<td></td>
	  				</tr>
	  			</tbody>
	  			<tfoot>
	  				<tr>
	  					<td colspan="3" style="text-align: left">合计金额：<span class="money_num">0</span></td>
	  				</tr>
	  			</tfoot>
	  		</table>
	  		<a id="subbit_form" class="button_a" style="padding:.5em 1.5em;" href="#" data-role="button" data-transition="slide" data-theme="f">提交订单</a>
	 	</div>
	  	<div class="add_person post_form">
	  		<h4>添加体检人信息</h4>
	  		<form id="form1" action="">
	  			<label data-role="none">姓名</label><input class="input" name="name" type="text" data-role="none" placeholder="请输入体检人姓名"><br>
		  		<label data-role="none">电话</label><input class="input" name="tele" type="tel" data-role="none" placeholder="请输入体检人电话"><br>
		  		<label data-role="none">身份证号</label><input class="input" name="idnum" type="tel" data-role="none" placeholder="请输入体检人身份证号"><br>
		  		<label data-role="none">内容</label><input readonly class="input" name="content" type="text" data-role="none" placeholder="点击选取体检项目"><br>
	  			<label data-role="none">门店</label><select style="width:50%;" name="store" id="store" data-role="none">
		         <!-- <option value="双东分院">双东分院(周日不营业)</option>
		         <option value="漪汾分院">漪汾分院(周日不营业)</option>
		         <option value="长风分院">长风分院(周一不营业)</option>
		         <option value="王村分院">王村分院(周一不营业)</option> -->
	        	</select>
	  			<label data-role="none">日期</label><input name="date" type="date" data-role="none" placeholder="输入体检日期" style="display:inline-block;min-width:5em"><br>
	  			<label data-role="none">时间</label><select name="time" id="time" data-role="none">
		         <option value="7:40—8:00">7:40—8:00</option>
		         <option value="8:00—8:20">8:00—8:20</option>
		         <option value="8:20—8:40">8:20—8:40</option>
		         <option value="8:40—9:00">8:40—9:00</option>
	        	</select>
	  		</form>
	  		<a id="add_person_btn" class="button_a" style="padding:.5em 1.5em;" href="#" data-role="button" data-transition="slide" data-theme="f">添加体检人</a>
	 		<script type="text/javascript">
	  			$(document).ready(function(){
	  				getSrceenWH();
	  				//localStorage.openID = "oEN_UwCbJgoTlejivtDvU4v8FqSs";
	  				//localStorage.city = "太原市";
		  			var URL = "http://mndjk.app0351.cn/mndjk/weixin.php/GTHqiye/getqiye";
		 			$.ajax({
		  				type: "post",
						url: URL,
						//contentType: "application/json",
						data: {
							"city":localStorage.city
				              },
						contentType: "application/x-www-form-urlencoded",
						async: true,
						timeout:3000,
						dataType:'json',  
						success: function(data) {
							var json = eval(data);
							if(json != null){
								if(json.code == "100"){
									if(json.data.mendianlist != null){
										var storeData = json.data.mendianlist;
										var len = storeData.length;
										var storeHtml = "";
										for(var i=0;i<len;i++){
											storeHtml += "<option value='"+storeData[i].mendianid+"'>"+storeData[i].mendianname+"</option>";
										}
										$('select[name="store"]').append(storeHtml);
									}else{
										$('select[name="store"]').append("<option value='no'>暂无门店</option>");
									}
									if(json.data.taocanlist != null){
										var taocanData = json.data.taocanlist;
										var len = taocanData.length;
										var taocanHtml = "";
										for(var i=0;i<len;i++){
											taocanHtml += "<tr id='"+taocanData[i].taocanid+"'>"+
											  				"<td class='choose'>"+taocanData[i].taocanname+" </td>"+
											  				"<td class='choose'>"+taocanData[i].realprice+"</td>"+
											  				"<td class='look_for'>详情</td>"+
											  				"</tr>";
										}
										$('.taocan_list_second').append(taocanHtml);
										$('input[name="content"]').focus(function(){ 
						  					$.mobile.changePage ('#djk_testTable', 'slideup', true, true);
						  				});
										$(".choose").click(function(){
							  				var taocanid = $(this).parent().attr("id");
							  				var taocanname = $(this).parent().find("td:nth-child(1)").text();
							  				var price = $(this).parent().find("td:nth-child(2)").text();
							  				$('input[name="content"]').val(taocanname);
							  				$('input[name="content"]').attr("id",taocanid);
							  				$('input[name="content"]').attr("pri",price);
							  				//$.mobile.changePage ('back', 'slideup');
							  				history.go(-1);
							  			});
							  			$(document).on("pageloadfailed",function(event,data){
										  alert("抱歉，被请求页面不存在。");
										});
										
								  		$(".look_for").click(function(){
								  			var taocanid = $(this).parent().attr("id");
											$.ajax({
												type: "post",
												url: "http://mndjk.app0351.cn/mndjk/weixin.php/GTHtaocan/getTaocanContent",
												//contentType: "application/json",
												data: {
														"openid":localStorage.openID,
														"taocanid":taocanid
									                },
												contentType: "application/x-www-form-urlencoded",
												async: true,
												timeout:3000,
												dataType:'json',  
												success: function(data) {
													var json = eval(data);
													var html = "";
													if(json != null && json != ""){
														if(json.code == "100"){
															var mydata = json.data;
															var img = mydata.img;
															$(".table_head img").attr("src",img);
															var content =mydata.content,
																len = content.length,
																xiangqing = "";
															for(var i=0;i<len;i++){
																if(content[i].remark == ""){
																	xiangqing = "<td class='wu'>无</td>";
																}else{
																	xiangqing = "<td class='canclick'>详情</td>";
																}
																html += "<tr><td>"+content[i].danxiangname+"</td>"+
																"<td>"+content[i].price+"</td>"+
																xiangqing+"<td class='xiangq' style='display:none'>"+content[i].remark+"</tr>";
															}
															$(".table_head h3").html(mydata.taocanname);
															$(".table_head div").append("<span style='margin-right:2em'><s>原价："+mydata.price+"</s></span>"+
									  									"<span style='margin-left:2em'>现价："+mydata.realprice+"</span>");
															$("#tBody_tao").append(html);
															$.mobile.changePage ('#djk_bodytest_page', 'slideup', true, true);
														}else{
															alert("错误。请重新获取");
														}
													}
													$(".canclick").click(function(){
														$(this).parent().addClass("hclick").siblings().removeClass("hclick"); 
														var remarkC = $(this).next().text();
														var remarkH = $(this).parent().find("td").first().text();
														//alert(remarkH);
														$("#dialog h4").html(remarkH);
														$("#dialog .xiangqingp").html(remarkC);
														$("#dialog").fadeIn();
														$("#dialogBG").show();
														
													});
													$(".wu").click(function(){
														alert("没有！！！");
													});
													$("#closeB").click(function(){
														$("#dialog").hide();
														$("#dialogBG").hide();
														$("#dialog h4").empty();
														$("#dialog .xiangqingp").empty();
													});
													//alert(JSON.stringify(json));
													//$(".table_body").append("<div>"+JSON.stringify(json)+"</div>");
													//alert(JSON.stringify(json.content));
												},
												complete:function(XMLHttpRequest,status){ //请求完成后最终执行参数
												   if(status=='timeout'){//超时,status还有success,error等值的情况
												      ajaxTimeoutTest.abort();
												      alert("网络状态不好诶~~");
												   };
												},
												error: function(err) {
													errormessage = "错啦！";
													alert(errormessage);	
												} 
											});
											return false;
										});
									}else{
										$('.taocan_list_second').append("<tr class='click_back'>"+
																"<td></td>"+
																"<td>暂无套餐，点击返回</td>"+
												  				"<td></td>"+
												  				"</tr>");
									}
									
									var arrayData = new Array();
									$("#add_person_btn").click(function(){
						  				var Name = $('input[name="name"]').val(),
						        		   Tele = $('input[name="tele"]').val(),
						        		   idnum = $('input[name="idnum"]').val(),
						        		   taocan = $('input[name="content"]').attr("id"),
						        		   price = $('input[name="content"]').attr("pri"),
						        		   store = $('select[name="store"]').val(),
						        		   date = $('input[name="date"]').val(),
						        		   time = $('select[name="time"]').val();
						        		   if(store == "20" || store == "22" || store=="25"){
									  			var n = new Date(date).getDay();
									  			if(n == 0){
									  				alert("您选的"+date+"是星期天,该医院星期天不营业,请重新选择日期");
									  				return false;
									  			}
									  		}else if(store == "21" || store == "23" || store=="24"){
									  			var n = new Date(date).getDay();
									  			if(n == 1){
									  				alert("您选的"+date+"是星期一,该医院星期一不营业,请重新选择日期");
									  				return false;
									  			}
									  		}
							  				$(".first_tr").hide();
							  				var data = {
							  					taocanid:taocan,
							  					price:price,
							  					name:Name,
							  					tele:Tele,
							  					cardnum:idnum,
							  					mendianid:store,
							  					time:date+" "+time
							  				};
							  				arrayData.push(data);
							  				var money = parseFloat($(".money_num").text());
							  				var pricen = parseFloat(price);
							        		$("#first_tbody").append("<tr class='body_mess'><td>"+
									        Name +"</td><td>"+date+"</td><td>"+time+"</td><td style='display:none'>"+
									        Tele+"</td><td style='display:none'>"+idnum+"</td><td style='display:none'>"+
									        taocan+"</td><td style='display:none'>"+
									        store+"</td><td style='display:none'>"+price+"</td></tr>");
									        $(".money_num").text(pricen+money);
						        			alert("添加成功");
						        			$('input[name="name"]').val("");
						        		   $('input[name="tele"]').val("");
						        		   $('input[name="idnum"]').val("");
						        		   $('input[name="content"]').val("");
						        		   $('select[name="store"]').val();
						        		   $('input[name="date"]').val("");
						        		   $('select[name="time"]').val();
						  				});
						  				$("#subbit_form").click(function(){
											if($(".first_tr").css("display") != "none"){
												alert("请添加联系人");
											}else{
												$.ajax({
								 					type: "post",
													url: "http://mndjk.app0351.cn/mndjk/weixin.php/GTHqiye/setDingdan",
													data: {
															'type':'qy',
															'openid':localStorage.openID,
															'qiye':JSON.stringify(arrayData)
										                },
													contentType: "application/x-www-form-urlencoded",
													async: true,
													timeout:3000,
													dataType:'json',  
													success: function(data) {
														//alert(data);
														var json = eval(data);
														if(json != null){
															if(json.code=="100"){
																var jsonData = json.data;
																var prices = $(".money_num").text();
																var dingdanhao = jsonData;
																location.href = "ptpayfortest.html?price="+prices+"&dingdanhao="+dingdanhao;
															}
														}
													},
													complete:function(XMLHttpRequest,status){ //请求完成后最终执行参数
													   if(status=='timeout'){//超时,status还有success,error等值的情况
													      ajaxTimeoutTest.abort();
													      alert("网络状态不好诶~~");
													   };
													},
													error: function(err) {
													}
								 				});
								 				return false;
											}
										});
									}else{
										alert("网络错误");
									}
							}
						},
						complete:function(XMLHttpRequest,status){ //请求完成后最终执行参数
						   if(status=='timeout'){//超时,status还有success,error等值的情况
						      ajaxTimeoutTest.abort();
						      alert("网络状态不好诶~~");
						   };
						},
						error: function(err) {
							alert("网络状态不好诶~~");	
						}
						});
					return false;
	  			});
	  			//为弹窗背景设置宽高
      		function getSrceenWH(){
				w = $(window).width();
				h = $(window).height();
				$('#dialogBG').width(w).height(h);
				$('#dialog').width(2*w/3).height(2*w/3);
				$('#dialog').css({"margin-top":-w/3 +"px","margin-left":-w/3+"px"});
			}
	  		</script>
	  	</div>
	  </div>
	</div>
	
	<!-- 体检项目页面 -->
	<div data-role="page" class="djk_page" id="djk_testTable">
	  <div data-role="main" class="ui-content">
	  	<div class="person_table">
	  		<table cellspacing="0">
	  			<thead>
	  				<tr>
	  				<th>套餐</th>
	  				<th>优惠价(元)</th>
	  				<th>套餐详情</th>
	  				</tr>
	  			</thead>
	  			<tbody class="taocan_list_second">
	  				<!-- <tr id="000001">
	  				<td>王风格 </td>
	  				<td>2016-12-5</td>
	  				<td>详情</td>
	  				</tr>
	  				<tr id="000002">
	  				<td>合风格 </td>
	  				<td>2016-12-5</td>
	  				<td>详情</td>
	  				</tr>
	  				<tr id="000003">
	  				<td>李风格 </td>
	  				<td>2016-12-5</td>
	  				<td>详情</td>
	  				</tr>
	  				<tr id="000004">
	  				<td>赵风格 </td>
	  				<td>2016-12-5</td>
	  				<td>详情</td>
	  				</tr> -->
	  			</tbody>
	  		</table>	   
	  		<script type="text/javascript">
	  		$(document).ready(function(){
	  			
		  	
		  	});
      		//为弹窗背景设置宽高
      		function getSrceenWH(){
				w = $(window).width();
				h = $(window).height();
				$('#dialogBG').width(w).height(h);
				$('#dialog').width(2*w/3).height(2*w/3);
				$('#dialog').css({"margin-top":-w/3 +"px","margin-left":-w/3+"px"});
			}
		  </script>
	  	</div>
	  </div>
	</div>
	
	<!-- 套餐详情界面 -->
	<div data-role="page" class="djk_page" id="djk_bodytest_page">
		  <div data-role="header" data-theme="f">
		  	<a class="back_a" data-rel="back" data-transition="slide" data-direction="reverse"><img src="../../src/images/Home/back.png"></a>
		    <h2 style="font-size:1.5em;font-weight: normal;text-shadow: none">套餐详情</h2>
		  </div>
		  <div data-role="main" class="ui-content">
		  	<div class="djk_test_body">
		  		<div class="table_head">
		  			<h3></h3>
		  			<img src="" style="width:80%">
		  			<div>
		  			<!-- <span style="margin-right:2em"><s>原价：123</s></span>
		  			<span style="margin-left:2em">现价：93</span> -->
		  			</div>
		  		</div>
		  		<div class="table_body">
		  			<table>
		  				<thead>
		  					<tr>
		  					<th>单项名称</th>
		    				<th>价格(元)</th>
		    				<th>单项体检详情</th>
		    				</tr>
		  				</thead>
		  				<tbody id="tBody_tao">
		  				</tbody>
		  			</table>
		  		</div>
		  	</div>
		  <div id="dialogBG"></div>
		  <div id="dialog">
		  	<div class="inner_border">
			  	<h4>日常体检</h4>
			  	<div class="xiangqingp">
			  	</div>
		  	</div>
			  <a id="closeB" class="button_a" data-role="button" data-transition="slide" data-theme="f">关闭</a>
	  		</div>
		  </div> 
	</div>
  </body>
</html>
